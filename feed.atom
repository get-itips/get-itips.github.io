<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
	<link rel="self" href="https://get-itips.github.io/" />
	<id>https://get-itips.github.io/</id>
	<title>PS &gt; Get-ITips</title>
	<rights>2018</rights>
	<updated>2018-02-21T20:23:03Z</updated>
	<subtitle>Tips from an IT Guy</subtitle>
	<entry>
		<link href="https://get-itips.github.io/posts/call-failed" />
		<id>https://get-itips.github.io/posts/call-failed</id>
		<title>Call failed to establish due to a media connectivity failure when both endpoints are...</title>
		<updated>2017-07-21T00:00:00Z</updated>
		<content>&lt;p&gt;internal&lt;br /&gt;
external&lt;br /&gt;
or one endpoint is internal and the other is federated or remote...&lt;/p&gt;
&lt;p&gt;any situation will do.&lt;/p&gt;
&lt;p&gt;This was happening to me on an On-Premise deployment of Skype For Business (Front end and Edge Server) calling to Unified Messaging contact on Exchange Online.&lt;/p&gt;
&lt;p&gt;ICE Candidate negotiation was happening but eventually no &lt;code&gt;remote-candidates&lt;/code&gt; were negotiated.&lt;/p&gt;
&lt;pre&gt;&lt;code class="language-cmd"&gt;ms-client-diagnostics: 22; reason=&amp;quot;Call failed to establish due to a media connectivity failure when both endpoints are internal&amp;quot;;UserType=&amp;quot;Callee&amp;quot;;MediaType=&amp;quot;audio&amp;quot;;MediaChanBlob=&amp;quot;NetworkErr=no error,ErrTime=0,RTPSeq=0,SeqDelta=0,RTPTime=0,RTCPTime=0,TransptRecvErr=0x0,RecvErrTime=0,TransptSendErr=0x0,SendErrTime=0,InterfacesStall=0x0,InterfacesConnCheck=0x0,MediaTimeout=0,RtcpByeSent=0,RtcpByeRcvd=0,BlobVer=1&amp;quot;;
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;So this must be firewall-related, this is almost always firewall-related, it seems first that the NAT was maybe responding with another external IP from de ISP Pool, but that was ok, the rules were correct, we checked and re-rechecked, and after so many hours of troubleshooting with Snooper and Wireshark, we started to look more deeply on the firewall and tried weird things.&lt;/p&gt;
&lt;p&gt;The firewall, a Fortigate one, had a NAT button enabled on the rule, you would say, that is obvious that must be activated... but we tried and deactivated that and... Voilá! we saw the face of god at that moment, it worked, the remote-candidates were negotiated at that moment  (so always be sure that this line is present if you want to know that it is working ok)&lt;/p&gt;
&lt;pre&gt;&lt;code class="language-cmd"&gt;a=remote-candidates:1 65.55.127.80 54860 2 65.55.127.80 54721
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;and we lived happily ever after.&lt;/p&gt;
</content>
		<summary>&lt;p&gt;internal&lt;br&gt;
external&lt;br&gt;
or one endpoint is internal and the other is federated or remote...&lt;/p&gt;</summary>
	</entry>
	<entry>
		<link href="https://get-itips.github.io/posts/handy-handshake" />
		<id>https://get-itips.github.io/posts/handy-handshake</id>
		<title>Handy SMTP Handshake for testing with Telnet</title>
		<updated>2017-02-08T00:00:00Z</updated>
		<content>&lt;p&gt;Hi,&lt;/p&gt;
&lt;p&gt;It's always useful to test SMTP service, using Telnet, so these are the commands needed:&lt;/p&gt;
&lt;p&gt;First of all, connect through Command Prompt or Powershell&lt;/p&gt;
&lt;pre&gt;&lt;code class="language-cmd"&gt;Telnet x.x.x.x tcpPort
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;For Example &lt;code&gt;Telnet 10.0.2.1 25&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;You will get a welcome message from SMTP Server, like this one:&lt;/p&gt;
&lt;p&gt;&lt;code&gt;220 exc02.contoso.com Microsoft ESMTP MAIL Service ready at Wed&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;then write sequentially hitting enter at each line what is coloured in green here (no color lines are server responses)&lt;/p&gt;
&lt;pre&gt;&lt;code class="language-code"&gt;EHLO mailtesting
AUTH LOGIN
334 VXNlcm5hbWU6
Y29udG9zb1xhY2NvdW50
334 UGFzc3dvcmQ6
dGhlUGFzc3dvcmQ=
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code class="language-code"&gt;MAIL FROM:
RCPT TO:
DATA
Subject: here comes the test 
This is the email content.
.
250 Queued mail for delivery 
&lt;/code&gt;&lt;/pre&gt;
&lt;hr /&gt;
&lt;p&gt;&lt;strong&gt;Important notes:&lt;/strong&gt;
You have to hit enter twice after subject input.
account name and password are entered Base64 encoded, so first encode that information using for example &lt;a href="https://www.base64encode.org/"&gt;this site.&lt;/a&gt;&lt;/p&gt;
</content>
		<summary>&lt;p&gt;Hi,&lt;/p&gt;</summary>
	</entry>
	<entry>
		<link href="https://get-itips.github.io/posts/csv-adPerm" />
		<id>https://get-itips.github.io/posts/csv-adPerm</id>
		<title>Powershell Script to CSV all AD Permissions for a particular Receive Connector</title>
		<updated>2017-02-08T00:00:00Z</updated>
		<content>&lt;p&gt;Hi,&lt;/p&gt;
&lt;p&gt;Had to do this PS Script for me to troubleshoot a receive connector permissions problem.
This will output to a CSV all permissions assigned to a receive connector, please change the $path and $connector variables to suit your needs&lt;br /&gt;
&lt;code&gt;`table_name`&lt;/code&gt;&lt;/p&gt;
&lt;pre&gt;&lt;code class="language-powershell"&gt;`table_name`
&lt;/code&gt;&lt;/pre&gt;
</content>
		<summary>&lt;p&gt;Hi,&lt;/p&gt;</summary>
	</entry>
</feed>